<script>
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  window.onload = function() {
    const reservationCode = getQueryParam('reservationCode');
    if (reservationCode) {
      fetchReservationData(reservationCode);
    } else {
      document.body.innerHTML = "<h1>Error: No se ha proporcionado un código de reserva</h1>";
    }
  };

  function fetchReservationData(reservationCode) {
    // Reemplaza 'YOUR_AIRTABLE_API_KEY' con tu clave API real y asegúrate de que esté protegida
    fetch(`https://api.airtable.com/v0/app897LPiEN5u7zPy/Reservations?filterByFormula={ReservationCode}='${reservationCode}'`, {
      headers: {
        Authorization: 'Bearer test'
      }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`Error: ${response.status} ${response.statusText}`);
      }
      return response.json();
    })
    .then(data => {
      if (data.records.length > 0) {
        const reservation = data.records[0].fields;
        document.getElementById('reservationCode').value = reservation.ReservationCode || '';
        document.getElementById('nick').value = reservation.Nick || '';
        document.getElementById('checkIn').value = reservation.CheckIn || '';
        document.getElementById('checkOut').value = reservation.CheckOut || '';
        document.getElementById('fullPrice').value = reservation.FullPrice || '';
        document.getElementById('netPrice').value = reservation.NetPrice || '';
        document.getElementById('guests').value = reservation.Guests || '';
        document.getElementById('place').value = reservation.Place || '';
      } else {
        document.body.innerHTML = "<h1>Error: No se encontraron datos de la reserva</h1>";
      }
    })
    .catch(error => {
      console.error('Error fetching data:', error);
      document.body.innerHTML = `<h1>Error al obtener datos de la reserva: ${error.message}</h1>`;
    });
  }
</script>
